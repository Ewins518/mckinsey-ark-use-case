{{/*
MCP Servers - Deploy after models but before agents
These resources provide tools and services that agents and teams can use
They should be deployed before agents so agents can reference them
*/}}
{{- if not .Values.excludeResources }}
{{- range $path, $_ := .Files.Glob "mcp-servers/*/chart/templates/mcpserver.yaml" }}
---
{{- $content := $.Files.Get $path }}
{{- $content | replace "metadata:" "metadata:\n  annotations:\n    \"helm.sh/hook\": pre-install,pre-upgrade\n    \"helm.sh/hook-weight\": \"-5\"\n    \"helm.sh/hook-delete-policy\": before-hook-creation" }}
{{- end }}
{{/*
Also include any standalone MCP server definitions in the mcp-servers directory
*/}}
{{- range $path, $_ := .Files.Glob "mcp-servers/*.yaml" }}
{{- $content := $.Files.Get $path }}
{{- if contains "kind: MCPServer" $content }}
---
{{- $content | replace "metadata:" "metadata:\n  annotations:\n    \"helm.sh/hook\": pre-install,pre-upgrade\n    \"helm.sh/hook-weight\": \"-5\"\n    \"helm.sh/hook-delete-policy\": before-hook-creation" }}
{{- end }}
{{- end }}
{{- end }}