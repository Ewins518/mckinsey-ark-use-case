{{- if .Values.containerRegistry.enabled }}
{{- if and .Values.containerRegistry.username .Values.containerRegistry.password }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "chart.fullname" . }}-registry
  labels:
    {{- include "chart.labels" . | nindent 4 }}
type: kubernetes.io/dockerconfigjson
stringData:
  .dockerconfigjson: |
    {
      "auths": {
        "{{ .Values.containerRegistry.server }}": {
          "username": "{{ .Values.containerRegistry.username }}",
          "password": "{{ .Values.containerRegistry.password }}"
          {{- if .Values.containerRegistry.email }},
          "email": "{{ .Values.containerRegistry.email }}"
          {{- end }}
        }
      }
    }
{{- else }}
{{- fail "Both containerRegistry.username and containerRegistry.password are required when containerRegistry.enabled is true" }}
{{- end }}
{{- end }}